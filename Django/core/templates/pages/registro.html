<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>
  {%load static%}

  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
</head>
<body id="navssss">
  {% include 'base/header.html' %} 

  <!-- Fin -->
  <div class="container-fluid">
    <div class="row">
      <form action="iniciosesion.html" id="formulario" class="col-6 text-center mx-auto shadow-lg mt-5 mb-3 p-3">
        <div class="my-3">
          <h2>Registrar Usuario</h2>
        </div>
        <div class="form-floating w-50 mx-auto mb-3">
          <input type="text" class="form-control" id="user" name="user" placeholder="Ingrese su nombre de usuario" required />
          <label for="user">Nombre de Usuario: </label>
        </div>
        <div class="form-floating w-50 mx-auto mb-3">
          <input type="password" class="form-control" id="pass" name="pass" placeholder="Ingrese su Contraseña" required />
          <label for="pass">Contraseña:</label>
        </div>
        <div class="form-floating w-50 mx-auto mb-3">
          <input type="text" class="form-control" id="txtRut" name="txtRut" placeholder="Ingrese su rut" required />
          <label for="txtRut">Rut</label>
        </div>
        <div class="form-floating w-50 mx-auto mb-3">
          <input type="text" class="form-control" id="txtNombre" name="txtNombre" placeholder="Nombre" required />
          <label for="txtNombre">Nombre</label>
        </div>
        <div class="row mx-auto">
          <div class="col mb-3">
            <div class="form-floating w-50 ms-auto">
              <input type="text" class="form-control" id="txtAppaterno" name="txtAppaterno" placeholder="Apellido paterno" required />
              <label for="txtAppaterno">Apellido paterno</label>
            </div>
          </div>
          <div class="col mb-3">
            <div class="form-floating w-50">
              <input type="text" class="form-control" id="txtApmaterno" name="txtApmaterno" placeholder="Apellido materno" required />
              <label for="txtApmaterno">Apellido materno</label>
            </div>
          </div>
        </div>
        <div class="form-floating w-50 mx-auto mb-3">
          <input type="date" class="form-control" id="txtFecha" name="txtFecha" placeholder="Fecha de Nacimiento" required />
          <label for="txtFecha">Fecha de Nacimiento</label>
        </div>
        <div class="row mx-auto">
          <div class="col mb-3">
            <div class="form-floating w-50 ms-auto">
              <input type="email" class="form-control" id="txtMail" name="txtMail" placeholder="Correo" required />
              <label for="txtMail">Correo</label>
            </div>
          </div>
          <div class="col mb-3">
            <div class="form-floating w-50">
              <input type="text" class="form-control" id="txtTelefono" name="txtTelefono" placeholder="Telefono" required />
              <label for="txtTelefono">Telefono</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 mb-2">
              <h3>Seleccione su género</h3>
          </div>
          <div class="col mb-3">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" value="Masculino" name="optGenero" id="optGenero1" />
              <label class="form-check-label" for="optGenero1">Masculino</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" value="Femenino" name="optGenero" id="optGenero2" />
              <label class="form-check-label" for="optGenero2">Femenino</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" value="Otro" name="optGenero" id="optGenero3" />
              <label class="form-check-label" for="optGenero3">Otro</label>
            </div>
          </div>
        </div>
        

        <div id="check"></div>
        <div class="w-50 mx-auto mb-3">
          <button type="button" id="btnEnviar" class="btn btn-outline-primary" href="iniciosesion.html">Registrarse</button>
          <input type="reset" value="Limpiar" class="btn btn-outline-danger">
        </div>
      </form>
    </div>
  </div>

  {% include 'base/footer.html' %} 
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'ruta/a/jquery.min.js' %}"></script>
  <script>
    $(document).ready(function () {
      $("#btnEnviar").click(function (event) {
      event.preventDefault();  // Evita el envío del formulario hasta que se validen los datos
      let rut = $("#txtRut").val();
      let nombre = $("#txtNombre").val();
      let appaterno = $("#txtAppaterno").val();
      let apmaterno = $("#txtApmaterno").val();
      let fecha = $("#txtFecha").val();
      let edad = calculateAge(fecha);
      let genero = $("input[name=optGenero]:checked").val();
      let mail = $("#txtMail").val();
      let telefono = $("#txtTelefono").val();
      let user = $("#user").val();
      let pass = $("#pass").val();

      if (validarDatos(rut, nombre, appaterno, apmaterno, edad, genero, telefono, mail, fecha, user, pass)) {
          $("#formulario").submit();
      }
    });
      function validarDatos(rut, nombre, appaterno, apmaterno, edad, genero, celular, mail, fecha, user, pass) {
        if (String(user).length < 5 || String(user).length > 15) {
            /* Validación de nombre de usuario */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>El nombre de usuario debe tener entre 5 y 15 caracteres</div>");
            return false;
        } else if (!/^[a-zA-Z0-9]+$/.test(user)) {
            /* Validación de caracteres del nombre de usuario */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>El nombre de usuario solo puede contener letras y números</div>");
            return false;
        } else if (String(pass).length < 8) {
            /* Validación de contraseña */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>La contraseña debe tener al menos 8 caracteres</div>");
            return false;
        } else if (!/[A-Z]/.test(pass) || !/[a-z]/.test(pass) || !/[0-9]/.test(pass)) {
            /* Validación de complejidad de la contraseña */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>La contraseña debe contener al menos una letra mayúscula, una letra minúscula y un número</div>");
            return false;
        } else if (String(rut).length < 9 || String(rut).length > 10) {
            /* Validación Rut */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Rut debe tener largo entre 9 y 10 caracteres</div>");
            return false;
        } else if (String(nombre).length < 3 || String(nombre).length > 20) {
            /* Validación Nombre */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Nombre debe tener largo entre 3 y 20 caracteres</div>");
            return false;
        } else if (String(appaterno).length < 3 || String(appaterno).length > 20) {
            /* Validación Apellido Paterno */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Apellido Paterno debe tener largo entre 3 y 20 caracteres</div>");
            return false;
        } else if (String(apmaterno).length < 3 || String(apmaterno).length > 20) {
            /* Validación Apellido Materno */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Apellido Materno debe tener largo entre 3 y 20 caracteres</div>");
            return false;
        } else if (Number(edad) < 18 || Number(edad) > 30) {
            /* Validación Edad */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Edad debe estar entre 18 y 30 años</div>");
            return false;
        } else if (genero != "Masculino" && genero != "Femenino" && genero != "Otro") {
            /* Validación Género */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Debe seleccionar un género válido</div>");
            return false;
        } else if (String(celular).length < 9 || String(celular).length > 12) {
            /* Validación Teléfono */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Teléfono debe tener entre 9 y 12 dígitos</div>");
            return false;
        } else if (!validateEmail(mail)) {
            /* Validación Email */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Debe ingresar un correo electrónico válido</div>");
            return false;
        } else if (!validateDate(fecha)) {
            /* Validación Fecha */
            $("#check").html("<div class='alert alert-danger w-50 mx-auto text-center'>Debe ingresar una fecha válida en formato AAAA-MM-DD</div>");
            return false;
        } else {
            /* Confirmación */
            $("#check").html("<div class='alert alert-success w-50 mx-auto text-center'>Datos ingresados con éxito</div>");
            return true;
        }
            // Confirmación
        $("#check").html("<div class='alert alert-success w-50 mx-auto text-center'>Datos ingresados con éxito</div>");

        // Guardar el usuario y la contraseña en el almacenamiento local
        localStorage.setItem("user", user);
        localStorage.setItem("pass", pass);
        window.location.href = "iniciosesion.html";
        return true;
      }
      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(String(email).toLowerCase());
      }

      function validateDate(date) {
        const re = /^\d{4}-\d{2}-\d{2}$/;
        return re.test(date);
      }

      function calculateAge(date) {
        const [day, month, year] = date.split('-');
        const cumpleaños = new Date(date);
        const hoy = new Date();
        let edad = hoy.getFullYear() - cumpleaños.getFullYear();
        const m = hoy.getMonth() - cumpleaños.getMonth();
        if (m < 0 || (m === 0 && cumpleaños.getDate() < cumpleaños.getDate())) {
          edad--;
        }
        return edad;
      }
    });
  </script>
</body>
</html>
